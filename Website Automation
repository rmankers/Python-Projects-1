#IAA Room Reservation 
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from threading import Timer
import tim

def book_a_room2():
    #Logging in to a chrome profile allows for passwords to be remember, thus bypassing 
    #some security features on websites (like duo authentication)
    options = webdriver.ChromeOptions() 
    options.add_argument("Path to Chrome Profile") 
    
    #Access
    driver_path = "Path to chromedriver"
    browser = webdriver.Chrome(executable_path=driver_path, options=options))
    browser.get("Room Reservation URL")
    
    #---------SHIBBOLETH-------
    
    #Fill in username and password
    email_elem = browser.find_element_by_id("username").send_keys('Username')
    password_elem = browser.find_element_by_id("password").send_keys('Password')
    
    #Click log in button
    LogIn_Button = browser.find_element_by_xpath("//*[@id='formSubmit']").click()
    
    #---------DUO-------
    
    ## Give time for iframe to load ##
    wait_accept1 = WebDriverWait(browser, 10)
    element_accept1 = wait_accept1.until(EC.element_to_be_clickable((By.XPATH,
                                                                   "//*[@id='content']/main/form/div[1]/p[2]/input[2]")))
    Wait_button1 = browser.find_element_by_xpath("//*[@id='content']/main/form/div[1]/p[2]/input[2]").click()
    
    ## Switch to the iframe
    browser.switch_to.frame(browser.find_element_by_tag_name("iframe"))
    
    ## Insert text via xpath
    Push_Button = browser.find_element_by_xpath("//*[@id='auth_methods']/fieldset/div[1]/button").click()
    
    ## Switch back to the "default content" (that is, out of the iframe) ##
    browser.switch_to.default_content()
    
    #-------Click accept to proceed
    wait_accept2 = WebDriverWait(browser, 10)
    element_accept2 = wait_accept2.until(EC.element_to_be_clickable((By.XPATH,
                                                                   "//*[@id='content']/main/form/div[1]/p[2]/input[2]")))
    
    browser.find_element_by_xpath("//*[@id='content']/main/form/div[1]/p[2]/input[2]").click()
    
    #--------Select room and time of next day
    #
    wait_next_day = WebDriverWait(browser, 10)
    element_next_day = wait_next_day.until(EC.element_to_be_clickable((By.XPATH,"//*[@id='onslow-1200']")))

    browser.find_element_by_xpath("//*[@id='onslow-1200']").click()
    browser.find_element_by_xpath("//*[@id='onslow-1230']").click()
    
    wait_next_day2 = WebDriverWait(browser, 10)
    element_next_day = wait_next_day2.until(EC.element_to_be_clickable((By.XPATH,"//*[@id='rt-day']")))
    browser.find_element_by_xpath("//*[@id='rt-day']").click()
    
import schedule
import time

schedule.every().day.at("21:00").do(book_a_room2)

while False:
    schedule.run_pending()
    time.sleep(1)
